<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ninja Shadow Legend</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; touch-action: none; font-family: 'Segoe UI', Tahoma, sans-serif; }
        canvas { display: block; }
        .ui-layer { position: absolute; top: 15px; left: 15px; color: gold; font-size: 22px; font-weight: bold; text-shadow: 2px 2px #000; z-index: 10; pointer-events: none; }
        .controls { position: fixed; bottom: 20px; width: 100%; display: flex; justify-content: space-around; align-items: center; z-index: 20; padding: 0 10px; box-sizing: border-box; }
        .btn { width: 65px; height: 65px; background: rgba(255, 255, 255, 0.1); border: 2px solid white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; color: white; backdrop-filter: blur(4px); }
        .btn:active { background: rgba(255, 255, 255, 0.4); transform: scale(0.9); }
        .attack-btn { background: rgba(231, 76, 60, 0.3); border-color: #e74c3c; color: #e74c3c; width: 80px; height: 80px; font-size: 35px; }
    </style>
</head>
<body>

    <div class="ui-layer">ğŸª™ Ø§Ù„Ø¹Ù…Ù„Ø§Øª: <span id="coins">0</span> | ğŸ©¸ Ø§Ù„ØµØ­Ø©: <span id="health">100</span>%</div>
    <canvas id="gameCanvas"></canvas>

    <div class="controls">
        <div style="display: flex; gap: 10px;">
            <div class="btn" id="lBtn">â†</div>
            <div class="btn" id="rBtn">â†’</div>
        </div>
        <div class="btn attack-btn" id="aBtn">âš”ï¸</div>
        <div class="btn" id="jBtn">â†‘</div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let score = 0;
        let health = 100;
        let cameraX = 0;

        let player = {
            x: 100, y: 0, w: 40, h: 60,
            dy: 0, jumpForce: 16, gravity: 0.7,
            grounded: false, vx: 0, speed: 6,
            isAttacking: false, attackTimer: 0
        };

        // Ù…ØµÙÙˆÙØ§Øª Ù„Ù„Ø£Ø¹Ø¯Ø§Ø¡ ÙˆØ§Ù„ÙÙ„ÙˆØ³
        let coins = [];
        let enemies = [];
        for(let i=0; i<50; i++) {
            coins.push({x: 500 + i*300 + Math.random()*200, y: canvas.height - 150, collected: false});
            enemies.push({x: 800 + i*600, y: canvas.height - 100, w: 40, h: 40, dead: false});
        }

        function drawNinja(x, y) {
            ctx.save();
            ctx.translate(x - cameraX, y);
            
            // Ø³ÙŠÙ Ø§Ù„Ù†ÙŠÙ†Ø¬Ø§
            if (player.isAttacking) {
                ctx.strokeStyle = "silver";
                ctx.lineWidth = 5;
                ctx.beginPath(); ctx.moveTo(40, 30); ctx.lineTo(80, 10); ctx.stroke();
            }

            // Ø§Ù„Ø¬Ø³Ù…
            ctx.fillStyle = "black";
            ctx.fillRect(0, 10, 30, 40);
            ctx.fillStyle = "#e74c3c"; ctx.fillRect(-2, 25, 34, 6); // Ø§Ù„Ø­Ø²Ø§Ù…
            ctx.fillStyle = "black";
            ctx.beginPath(); ctx.arc(15, 0, 15, 0, Math.PI*2); ctx.fill(); // Ø§Ù„Ø±Ø£Ø³
            ctx.fillStyle = "white"; ctx.fillRect(18, -5, 10, 3); // Ø§Ù„Ø¹ÙŠÙ†
            ctx.restore();
        }

        function drawWorld() {
            // Ø³Ù…Ø§Ø¡ Ù…ØªØ­Ø±ÙƒØ©
            let grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
            grad.addColorStop(0, "#0f0c29"); grad.addColorStop(1, "#302b63");
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Ø£Ø±Ø¶ÙŠØ© Ù…ØªØ­Ø±ÙƒØ© Ù…Ø¹ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            ctx.fillStyle = "#1a1a1a";
            ctx.fillRect(0 - (cameraX % canvas.width), canvas.height - 50, canvas.width, 50);
            ctx.fillRect(canvas.width - (cameraX % canvas.width), canvas.height - 50, canvas.width, 50);

            // Ø±Ø³Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Øª
            coins.forEach(c => {
                if(!c.collected) {
                    ctx.fillStyle = "gold";
                    ctx.beginPath(); ctx.arc(c.x - cameraX, c.y, 10, 0, Math.PI*2); ctx.fill();
                }
            });

            // Ø±Ø³Ù… Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
            enemies.forEach(e => {
                if(!e.dead) {
                    ctx.fillStyle = "#c0392b";
                    ctx.fillRect(e.x - cameraX, e.y, e.w, e.h);
                }
            });
        }

        function update() {
            player.dy += player.gravity;
            player.y += player.dy;
            player.x += player.vx;

            // Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªØªØ¨Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨
            cameraX = player.x - 100;

            if (player.y + player.h > canvas.height - 50) {
                player.y = canvas.height - 50 - player.h;
                player.dy = 0;
                player.grounded = true;
            }

            // Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
            coins.forEach(c => {
                if(!c.collected && Math.abs(player.x - c.x) < 30 && Math.abs(player.y - c.y) < 50) {
                    c.collected = true; score += 10;
                    document.getElementById('coins').innerText = score;
                }
            });

            // Ù‚ØªØ§Ù„ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
            enemies.forEach(e => {
                if(!e.dead) {
                    let dist = Math.abs(player.x - e.x);
                    if(player.isAttacking && dist < 100) e.dead = true;
                    else if(dist < 40 && Math.abs(player.y - e.y) < 40) {
                        health -= 0.5;
                        document.getElementById('health').innerText = Math.floor(health);
                        if(health <= 0) location.reload();
                    }
                }
            });

            if (player.isAttacking) {
                player.attackTimer--;
                if(player.attackTimer <= 0) player.isAttacking = false;
            }
        }

        function loop() {
            drawWorld();
            drawNinja(player.x, player.y);
            update();
            requestAnimationFrame(loop);
        }

        document.getElementById('lBtn').ontouchstart = () => player.vx = -player.speed;
        document.getElementById('rBtn').ontouchstart = () => player.vx = player.speed;
        document.getElementById('lBtn').ontouchend = document.getElementById('rBtn').ontouchend = () => player.vx = 0;
        document.getElementById('jBtn').ontouchstart = () => { if(player.grounded) player.dy = -player.jumpForce; };
        document.getElementById('aBtn').ontouchstart = () => { player.isAttacking = true; player.attackTimer = 15; };

        loop();
    </script>
</body>
</html>
