<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ninja City Legend</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; touch-action: none; font-family: 'Segoe UI', Tahoma, sans-serif; }
        canvas { display: block; background: #0f172a; /* ŸÑŸàŸÜ ÿ≥ŸÖÿßÿ° ÿßŸÑŸÑŸäŸÑ */ }
        .ui-layer { position: absolute; top: 15px; left: 15px; color: gold; font-size: 22px; font-weight: bold; text-shadow: 2px 2px #000; z-index: 10; pointer-events: none; }
        .controls { position: fixed; bottom: 20px; width: 100%; display: flex; justify-content: space-around; align-items: center; z-index: 20; padding: 0 10px; box-sizing: border-box; }
        .btn { width: 65px; height: 65px; background: rgba(255, 255, 255, 0.1); border: 2px solid white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; color: white; backdrop-filter: blur(4px); }
        .btn:active { background: rgba(255, 255, 255, 0.4); transform: scale(0.9); }
        .attack-btn { background: rgba(231, 76, 60, 0.3); border-color: #e74c3c; color: #e74c3c; width: 80px; height: 80px; font-size: 35px; }
    </style>
</head>
<body>

    <div class="ui-layer">ü™ô ÿßŸÑÿπŸÖŸÑÿßÿ™: <span id="coins">0</span> | ü©∏ ÿßŸÑÿµÿ≠ÿ©: <span id="health">100</span>%</div>
    <canvas id="gameCanvas"></canvas>

    <div class="controls">
        <div style="display: flex; gap: 10px;">
            <div class="btn" id="lBtn">‚Üê</div>
            <div class="btn" id="rBtn">‚Üí</div>
        </div>
        <div class="btn attack-btn" id="aBtn">‚öîÔ∏è</div>
        <div class="btn" id="jBtn">‚Üë</div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let score = 0;
        let health = 100;

        let player = {
            x: 100, y: 0, w: 40, h: 60,
            dy: 0, jumpForce: 16, gravity: 0.7,
            grounded: false, vx: 0, speed: 6,
            isAttacking: false, attackTimer: 0,
            facingRight: true // ÿßÿ™ÿ¨ÿßŸá ÿßŸÑŸÑÿßÿπÿ®
        };

        // ÿ™ÿµŸÖŸäŸÖ ŸÖÿ≥ÿ™ŸàŸäÿßÿ™ ÿ®ÿ≥Ÿäÿ∑ÿ© (ÿ£ŸÖÿßŸÉŸÜ ÿßŸÑÿ£ÿπÿØÿßÿ° ŸàÿßŸÑÿπŸÖŸÑÿßÿ™)
        let levelObjects = [
            // ŸÖÿ®ÿßŸÜŸä ŸÉÿÆŸÑŸÅŸäÿ©
            {type: 'building', x: 200, y: canvas.height - 200, w: 100, h: 150},
            {type: 'building', x: 400, y: canvas.height - 250, w: 120, h: 200},
            {type: 'building', x: 700, y: canvas.height - 180, w: 90, h: 130},
            
            // ŸÖŸÜÿµÿßÿ™ (ŸÑŸÑŸÇŸÅÿ≤ ÿπŸÑŸäŸáÿß)
            {type: 'platform', x: 300, y: canvas.height - 150, w: 100, h: 20},
            {type: 'platform', x: 550, y: canvas.height - 220, w: 80, h: 20},

            // ÿπŸÖŸÑÿßÿ™
            {type: 'coin', x: 250, y: canvas.height - 100, collected: false},
            {type: 'coin', x: 450, y: canvas.height - 180, collected: false},
            {type: 'coin', x: 600, y: canvas.height - 260, collected: false},

            // ÿ£ÿπÿØÿßÿ°
            {type: 'enemy', x: 350, y: canvas.height - 100, w: 40, h: 40, dead: false, speed: 1},
            {type: 'enemy', x: 650, y: canvas.height - 100, w: 40, h: 40, dead: false, speed: 1}
        ];

        function drawNinja(x, y) {
            ctx.save();
            ctx.translate(x, y);
            if (!player.facingRight) { // ŸÑŸà ÿßŸÑŸÑÿßÿπÿ® ŸÖÿ™ÿ¨Ÿá ÿ¥ŸÖÿßŸÑÿå ÿßŸÇŸÑÿ®Ÿá
                ctx.scale(-1, 1);
                ctx.translate(-player.w, 0); // ÿ∏ÿ®ÿ∑ ŸÖŸÉÿßŸÜŸá ÿ®ÿπÿØ ÿßŸÑŸÇŸÑÿ®
            }
            
            // ÿ≥ŸäŸÅ ÿßŸÑŸÜŸäŸÜÿ¨ÿß
            if (player.isAttacking) {
                ctx.strokeStyle = "silver";
                ctx.lineWidth = 5;
                ctx.beginPath(); ctx.moveTo(player.w - 10, 30); ctx.lineTo(player.w + 30, 10); ctx.stroke();
            }

            // ÿßŸÑÿ¨ÿ≥ŸÖ ŸàÿßŸÑÿ±ÿ£ÿ≥ ŸàÿßŸÑÿπŸäŸÜ ŸàÿßŸÑÿ≠ÿ≤ÿßŸÖ
            ctx.fillStyle = "black"; ctx.fillRect(0, 10, 30, 40);
            ctx.fillStyle = "#e74c3c"; ctx.fillRect(-2, 25, 34, 6);
            ctx.fillStyle = "black"; ctx.beginPath(); ctx.arc(15, 0, 15, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = "white"; ctx.fillRect(18, -5, 10, 3);
            ctx.restore();
        }

        function drawWorld() {
            // ÿßŸÑÿ£ÿ±ÿ∂Ÿäÿ©
            ctx.fillStyle = "#222"; // ŸÑŸàŸÜ ÿ£ÿ±ÿ∂Ÿäÿ© ÿßŸÑŸÖÿØŸäŸÜÿ©
            ctx.fillRect(0, canvas.height - 50, canvas.width, 50);

            levelObjects.forEach(obj => {
                if (obj.type === 'building') {
                    ctx.fillStyle = "#333";
                    ctx.fillRect(obj.x, obj.y, obj.w, obj.h);
                    // ŸÜŸàÿßŸÅÿ∞
                    ctx.fillStyle = "#7f8c8d";
                    ctx.fillRect(obj.x + 10, obj.y + 20, 15, 15);
                    ctx.fillRect(obj.x + obj.w - 25, obj.y + 40, 15, 15);
                } else if (obj.type === 'platform') {
                    ctx.fillStyle = "#4a4a4a";
                    ctx.fillRect(obj.x, obj.y, obj.w, obj.h);
                } else if (obj.type === 'coin' && !obj.collected) {
                    ctx.fillStyle = "gold";
                    ctx.beginPath(); ctx.arc(obj.x, obj.y, 10, 0, Math.PI*2); ctx.fill();
                } else if (obj.type === 'enemy' && !obj.dead) {
                    ctx.fillStyle = "#c0392b";
                    ctx.fillRect(obj.x, obj.y, obj.w, obj.h);
                }
            });
        }

        function update() {
            player.dy += player.gravity;
            player.y += player.dy;
            player.x += player.vx;

            // ÿßÿµÿ∑ÿØÿßŸÖ ÿ®ÿ£ÿ∑ÿ±ÿßŸÅ ÿßŸÑÿ¥ÿßÿ¥ÿ©
            if (player.x < 0) player.x = 0;
            if (player.x + player.w > canvas.width) player.x = canvas.width - player.w;

            // ÿßÿµÿ∑ÿØÿßŸÖ ÿ®ÿßŸÑÿ£ÿ±ÿ∂
            if (player.y + player.h > canvas.height - 50) {
                player.y = canvas.height - 50 - player.h;
                player.dy = 0;
                player.grounded = true;
            } else { player.grounded = false; }

            // ÿßÿµÿ∑ÿØÿßŸÖ ÿ®ÿßŸÑŸÖŸÜÿµÿßÿ™
            levelObjects.forEach(obj => {
                if (obj.type === 'platform' &&
                    player.x < obj.x + obj.w && player.x + player.w > obj.x &&
                    player.y + player.h > obj.y && player.y + player.h < obj.y + obj.h + 10 && player.dy >= 0) {
                    player.y = obj.y - player.h;
                    player.dy = 0;
                    player.grounded = true;
                }
            });

            // ÿ¨ŸÖÿπ ÿßŸÑÿπŸÖŸÑÿßÿ™
            levelObjects.forEach(obj => {
                if (obj.type === 'coin' && !obj.collected &&
                    Math.abs(player.x - obj.x) < 30 && Math.abs(player.y - obj.y) < 50) {
                    obj.collected = true; score += 10;
                    document.getElementById('coins').innerText = score;
                }
            });

            // ŸÇÿ™ÿßŸÑ ÿßŸÑÿ£ÿπÿØÿßÿ° ŸàÿßŸÑÿ™ÿµÿßÿØŸÖ
            levelObjects.forEach(obj => {
                if (obj.type === 'enemy' && !obj.dead) {
                    // ÿ≠ÿ±ŸÉÿ© ÿßŸÑÿπÿØŸà (ÿ®ÿ≥Ÿäÿ∑ÿ©)
                    obj.x += obj.speed;
                    if (obj.x > canvas.width - obj.w || obj.x < 0) obj.speed *= -1;

                    // ÿ™ÿµÿßÿØŸÖ ŸÖÿπ ÿßŸÑŸÑÿßÿπÿ®
                    if(player.x < obj.x + obj.w && player.x + player.w > obj.x &&
                       player.y < obj.y + obj.h && player.y + player.h > obj.y) {
                        if (player.isAttacking) {
                            obj.dead = true;
                        } else {
                            health -= 1;
                            document.getElementById('health').innerText = Math.floor(health);
                            if (health <= 0) alert('ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑŸÑÿπÿ®ÿ©! ŸÜŸÇÿßÿ∑ŸÉ: ' + score); location.reload();
                        }
                    }
                }
            });

            if (player.isAttacking) {
                player.attackTimer--;
                if(player.attackTimer <= 0) player.isAttacking = false;
            }
        }

        function loop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawWorld();
            drawNinja(player.x, player.y);
            update();
            requestAnimationFrame(loop);
        }

        document.getElementById('lBtn').ontouchstart = () => { player.vx = -player.speed; player.facingRight = false; };
        document.getElementById('rBtn').ontouchstart = () => { player.vx = player.speed; player.facingRight = true; };
        document.getElementById('lBtn').ontouchend = document.getElementById('rBtn').ontouchend = () => player.vx = 0;
        document.getElementById('jBtn').ontouchstart = () => { if(player.grounded) player.dy = -player.jumpForce; };
        document.getElementById('aBtn').ontouchstart = () => { player.isAttacking = true; player.attackTimer = 15; };

        loop();
    </script>
</body>
</html>
